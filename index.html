<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Teklif Olu≈ütur ve Y√∂net</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f5f7fa;
      margin: 0; padding: 20px;
    }
    .container {
      max-width: 1200px;
      margin: auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    .logo {text-align:center; margin-bottom:20px;}
    .logo img {width: 150px;}
    h2 {text-align:center; color:#333; margin-bottom:30px;}
    label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      margin-bottom: 15px;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      background-color: #007bff;
      color: white;
      border: none;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover:not(:disabled) {
      background-color: #0056b3;
    }
    button:disabled {
      background-color: #999;
      cursor: not-allowed;
    }
    #output {
      margin-top: 30px;
      min-height: 180px;
    }

    /* Loading spinner */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #007bff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .loading-text {
      color: #666;
      font-style: italic;
      text-align: center;
      padding: 20px;
    }

    /* Firebase baƒülantƒ± durumu */
    .firebase-status {
      position: fixed;
      top: 10px;
      right: 10px;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 12px;
      font-weight: bold;
      z-index: 1000;
    }
    .firebase-connected {
      background-color: #28a745;
      color: white;
    }
    .firebase-disconnected {
      background-color: #dc3545;
      color: white;
    }

    /* Yeni Liste Tasarƒ±mƒ± */
    .search-container {
      margin: 20px 0;
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .search-input {
      flex: 1;
      padding: 10px;
      border: 2px solid #007bff;
      border-radius: 5px;
      font-size: 14px;
    }
    .search-btn {
      padding: 10px 20px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      width: auto;
    }
    .clear-btn {
      padding: 10px 15px;
      background: #6c757d;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      width: auto;
    }

    .list-container {
      background: #f8f9fa;
      border-radius: 8px;
      overflow: hidden;
      margin-top: 15px;
    }
    .list-header {
      background: #007bff;
      color: white;
      padding: 15px;
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr 1fr 150px;
      gap: 10px;
      font-weight: bold;
      font-size: 14px;
    }
    .list-item {
      padding: 12px 15px;
      border-bottom: 1px solid #e9ecef;
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr 1fr 150px;
      gap: 10px;
      align-items: center;
      background: white;
      transition: background-color 0.2s;
      font-size: 14px;
    }
    .list-item:hover {
      background-color: #f8f9fa;
    }
    .list-item:last-child {
      border-bottom: none;
    }
    .list-actions {
      display: flex;
      gap: 5px;
    }
    .list-actions button {
      padding: 4px 8px;
      font-size: 12px;
      border-radius: 3px;
      width: auto;
      margin: 0;
    }
    .btn-view { background: #17a2b8; }
    .btn-edit { background: #ffc107; color: #212529; }
    .btn-delete { background: #dc3545; }
    .btn-contract { background: #28a745; }
    .btn-pdf { background: #6c757d; }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: #6c757d;
      font-style: italic;
    }

    /* Accordion Men√º */
    .accordion {
      background-color: #007bff;
      color: white;
      cursor: pointer;
      padding: 15px 20px;
      width: 100%;
      border: none;
      text-align: left;
      outline: none;
      font-size: 18px;
      border-radius: 8px;
      margin-top: 25px;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    .accordion:hover {
      background-color: #0056b3;
    }
    .accordion.active {
      background-color: #00408d;
    }
    .panel {
      padding: 0;
      display: none;
      background-color: white;
      overflow: hidden;
      border: 1px solid #007bff;
      border-top: none;
      border-radius: 0 0 8px 8px;
    }

    /* Edit form styles */
    #editForm {
      background: #eef5ff;
      border: 2px solid #0056b3;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
    }
    #editForm label {
      font-weight: bold;
      margin-top: 5px;
    }
    #editForm button {
      width: 48%;
      margin-top: 10px;
    }
    #editForm .btn-cancel {
      background-color: #dc3545;
    }
    #editForm .btn-cancel:hover {
      background-color: #a71d2a;
    }

    /* PDF i√ßin √∂zel stiller */
    .pdf-content {
      background: white;
      padding: 40px;
      margin: 20px;
      border: 1px solid #ddd;
      font-family: 'Segoe UI', Arial, sans-serif;
      line-height: 1.6;
      color: #333;
    }
    
    .pdf-header {
      text-align: center
      
      margin-bottom: 30px;
      border-bottom: 2px solid #007bff;
      padding-bottom: 20px;
    }
    
    .pdf-header img {
      max-height: 80px;
      margin-bottom: 15px;
    }
    
    .pdf-title {
      color: #007bff;
      font-size: 24px;
      font-weight: bold;
      margin: 0;
    }
    
    .pdf-body {
      font-size: 16px;
    }
    
    .pdf-body p {
      margin: 12px 0;
    }
    
    .pdf-body strong {
      color: #007bff;
    }
    
    .pdf-footer {
      margin-top: 40px;
      text-align: center;
      font-size: 14px;
      color: #666;
      border-top: 1px solid #ddd;
      padding-top: 20px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .list-header, .list-item {
        grid-template-columns: 1fr;
        gap: 5px;
      }
      .list-header {
        display: none;
      }
      .list-item {
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 10px;
      }
      .search-container {
        flex-direction: column;
      }
    }

    /* Yazdƒ±r i√ßin gizle */
    @media print {
      body * {
        visibility: hidden;
      }
      .pdf-content, .pdf-content * {
        visibility: visible;
      }
      .pdf-content {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        margin: 0;
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <!-- Firebase baƒülantƒ± durumu -->
  <div id="firebaseStatus" class="firebase-status firebase-disconnected">
    üî¥ Firebase Baƒülanƒ±yor...
  </div>

  <div class="container">
    <div class="logo">
      <img src="https://i.hizliresim.com/eqyhuxx.png" alt="Logo" />
    </div>
    <h2>TEKLƒ∞F OLU≈ûTUR</h2>

    <label>M√º≈üteri Adƒ±</label>
    <input type="text" id="ad" />

    <label>√áekim T√ºr√º</label>
    <input type="text" id="cekim" placeholder="√ñrn: D√ºƒü√ºn, Save the Date, √úr√ºn" />

    <label>Paket Se√ßimi</label>
    <select id="paket" onchange="paketBilgisiYukle()">
      <option value="">-- Paket Se√ßin --</option>
      <option value="bronze">Bronze</option>
      <option value="silver">Silver</option>
      <option value="gold">Gold</option>
    </select>

    <label>Etkinlik Yeri</label>
    <input type="text" id="yer" placeholder="√ñrn: ƒ∞stanbul, Kemerburgaz Ormanƒ±" />

    <label>Tarih</label>
    <input type="date" id="tarih" />

    <label>Fiyat (TL)</label>
    <input type="number" id="fiyat" />

    <label>A√ßƒ±klama</label>
    <textarea id="aciklama" rows="3" placeholder="Detaylar..."></textarea>

    <label>Referans Ki≈üi</label>
    <input type="text" id="referans" placeholder="Seni √∂neren ki≈üi (isteƒüe baƒülƒ±)" />

    <button onclick="teklifHazirla()" id="teklifBtn">TEKLƒ∞Fƒ∞ OLU≈ûTUR</button>

    <div id="output"></div>

    <button class="accordion">Teklifler</button>
    <div class="panel" id="tekliflerPanel">
      <div class="search-container">
        <input type="text" id="teklifArama" class="search-input" placeholder="M√º≈üteri adƒ±, paket, yer ile arayƒ±n...">
        <button onclick="teklifAra()" class="search-btn">üîç Ara</button>
        <button onclick="aramaTemizle('teklif')" class="clear-btn">Temizle</button>
        
      </div>
      <div id="tekliflerListesi" class="list-container"></div>
    </div>

    <button class="accordion">S√∂zle≈ümeler</button>
    <div class="panel" id="sozlesmelerPanel">
      <div class="search-container">
        <input type="text" id="sozlesmeArama" class="search-input" placeholder="M√º≈üteri adƒ±, paket, yer ile arayƒ±n...">
        <button onclick="sozlesmeAra()" class="search-btn">üîç Ara</button>
        <button onclick="aramaTemizle('sozlesme')" class="clear-btn">Temizle</button>
      </div>
      <div id="sozlesmelerListesi" class="list-container"></div>
    </div>

    <!-- D√ºzenleme Formu (gizli) -->
    <div id="editForm" style="display:none;">
      <h3>Teklifi D√ºzenle</h3>
      <label>M√º≈üteri Adƒ±</label>
      <input type="text" id="editAd" />

      <label>√áekim T√ºr√º</label>
      <input type="text" id="editCekim" placeholder="√ñrn: D√ºƒü√ºn, Save the Date, √úr√ºn" />

      <label>Paket Se√ßimi</label>
      <select id="editPaket" onchange="editPaketBilgisiYukle()">
        <option value="">-- Paket Se√ßin --</option>
        <option value="bronze">Bronze</option>
        <option value="silver">Silver</option>
        <option value="gold">Gold</option>
      </select>

      <label>Etkinlik Yeri</label>
      <input type="text" id="editYer" placeholder="√ñrn: ƒ∞stanbul, Kemerburgaz Ormanƒ±" />

      <label>Tarih</label>
      <input type="date" id="editTarih" />

      <label>Fiyat (TL)</label>
      <input type="number" id="editFiyat" />

      <label>A√ßƒ±klama</label>
      <textarea id="editAciklama" rows="3" placeholder="Detaylar..."></textarea>

      <label>Referans Ki≈üi</label>
      <input type="text" id="editReferans" placeholder="Seni √∂neren ki≈üi (isteƒüe baƒülƒ±)" />

      <button onclick="kaydetDuzenleme()">Kaydet</button>
      <button class="btn-cancel" onclick="iptalDuzenleme()">ƒ∞ptal</button>
    </div>
  </div>

  <!-- PDF i√ßeriƒüi i√ßin gizli div -->
  <div id="pdfContent" class="pdf-content" style="display:none;">
    <!-- PDF i√ßeriƒüi buraya dinamik olarak eklenecek -->
  </div>

  <!-- Firebase SDK -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-firestore-compat.min.js"></script>
  <script src="https://apis.google.com/js/api.js"></script>


<script>
  // Firebase Configuration
  const firebaseConfig = {
    apiKey: "AIzaSyDMMpU1l8zabgaw7bfSHKCOxLbz-RhNT7I",
    authDomain: "databasepsv-dc1b7.firebaseapp.com",
    databaseURL: "https://databasepsv-dc1b7-default-rtdb.firebaseio.com",
    projectId: "databasepsv-dc1b7",
    storageBucket: "databasepsv-dc1b7.firebasestorage.app",
    messagingSenderId: "106474799557",
    appId: "1:106474799557:web:8f7cff2b7ef8466ab08bac",
    measurementId: "G-BKKE9YZS1T"
  };

  // Firebase'i ba≈ülat
  let db;
  let firebaseConnected = false;

  try {
    firebase.initializeApp(firebaseConfig);
    db = firebase.firestore();
    firebaseConnected = true;
    updateFirebaseStatus(true);
    console.log("Firebase ba≈üarƒ±yla baƒülandƒ±!");
  } catch (error) {
    console.error("Firebase baƒülantƒ± hatasƒ±:", error);
    updateFirebaseStatus(false);
    alert("Firebase baƒülantƒ±sƒ± kurulamadƒ±. Veriler ge√ßici olarak tarayƒ±cƒ±da saklanacak.");
  }

  function updateFirebaseStatus(connected) {
    const statusEl = document.getElementById('firebaseStatus');
    if (connected) {
      statusEl.textContent = 'üü¢ Firebase Baƒülƒ±';
      statusEl.className = 'firebase-status firebase-connected';
    } else {
      statusEl.textContent = 'üî¥ Firebase Baƒülantƒ±sƒ±z';
      statusEl.className = 'firebase-status firebase-disconnected';
    }
  }

  const paketler = {
    bronze: {
      fiyat: 3000,
      aciklama: "2 saat √ßekim, 30 d√ºzenlenmi≈ü fotoƒüraf, 1 dakikalƒ±k reels"
    },
    silver: {
      fiyat: 5000,
      aciklama: "4 saat √ßekim, 60 d√ºzenlenmi≈ü fotoƒüraf, 2 dakikalƒ±k klip"
    },
    gold: {
      fiyat: 8000,
      aciklama: "T√ºm g√ºn √ßekim, 100+ fotoƒüraf, drone + 3 dakikalƒ±k klip"
    }
  };

  let teklifler = [];
  let sozlesmeler = [];
  let duzenlenenTeklifId = null;
  let filtreliTeklifler = [];
  let filtreliSozlesmeler = [];

  // Sayfa y√ºklendiƒüinde verileri √ßek
  window.addEventListener('load', async () => {
    await veriCek();
  });

  // Firebase'den verileri √ßek
  async function veriCek() {
    if (!firebaseConnected) {
      console.log("Firebase baƒülantƒ±sƒ± yok, yerel veriler kullanƒ±lƒ±yor.");
      return;
    }

    try {
      showLoading("tekliflerListesi");
      showLoading("sozlesmelerListesi");

      // Teklifleri √ßek
      const teklifSnapshot = await db.collection('teklifler').orderBy('createdAt', 'desc').get();
      teklifler = [];
      teklifSnapshot.forEach(doc => {
        teklifler.push({
          id: doc.id,
          ...doc.data()
        });
      });

      // S√∂zle≈ümeleri √ßek
      const sozlesmeSnapshot = await db.collection('sozlesmeler').orderBy('createdAt', 'desc').get();
      sozlesmeler = [];
      sozlesmeSnapshot.forEach(doc => {
        sozlesmeler.push({
          id: doc.id,
          ...doc.data()
        });
      });

      filtreliTeklifler = [...teklifler];
      filtreliSozlesmeler = [...sozlesmeler];
      renderTeklifler();
      renderSozlesmeler();
    } catch (error) {
      console.error("Veri √ßekme hatasƒ±:", error);
      document.getElementById('output').innerHTML = `
        <div style="color: red; padding: 10px; border: 1px solid red; border-radius: 5px;">
          ‚ùå Veriler y√ºklenirken hata olu≈ütu: ${error.message}
        </div>
      `;
    }
  }

  function showLoading(containerId) {
    document.getElementById(containerId).innerHTML = `
      <div class="loading-text">
        <div class="loading"></div>
        Veriler y√ºkleniyor...
      </div>
    `;
  }

  // Accordion a√ß/kapa
  document.querySelectorAll(".accordion").forEach(button => {
    button.addEventListener("click", () => {
      button.classList.toggle("active");
      const panel = button.nextElementSibling;
      if(panel.style.display === "block") {
        panel.style.display = "none";
      } else {
        panel.style.display = "block";
      }
    });
  });

  function paketBilgisiYukle() {
    const secilen = document.getElementById("paket").value;
    if (paketler[secilen]) {
      document.getElementById("fiyat").value = paketler[secilen].fiyat;
      document.getElementById("aciklama").value = paketler[secilen].aciklama;
    }
  }

  function editPaketBilgisiYukle() {
    const secilen = document.getElementById("editPaket").value;
    if (paketler[secilen]) {
      document.getElementById("editFiyat").value = paketler[secilen].fiyat;
      document.getElementById("editAciklama").value = paketler[secilen].aciklama;
    }
  }

  async function teklifHazirla() {
    const ad = document.getElementById("ad").value.trim();
	googleTakvimGirisYap(() => {
  googleTakvimeEkle(teklif, '9'); // mavi renk
});

    if (!ad) {
      alert("M√º≈üteri adƒ± bo≈ü bƒ±rakƒ±lamaz!");
      return;
    }

    const btn = document.getElementById("teklifBtn");
    btn.disabled = true;
    btn.innerHTML = '<div class="loading"></div> Teklif Olu≈üturuluyor...';

    const cekim = document.getElementById("cekim").value
      .split(',')
      .map(c => c.trim())
      .filter(Boolean)
      .map(c => `- ${c}`)
      .join('<br>');
    const paket = document.getElementById("paket").value.toUpperCase();
    const yer = document.getElementById("yer").value;
    const tarih = document.getElementById("tarih").value;
    const fiyat = document.getElementById("fiyat").value;
    const aciklama = document.getElementById("aciklama").value.replace(/\n/g, '<br>');
    const referans = document.getElementById("referans").value;
    const bugun = new Date().toLocaleDateString('tr-TR');

    const teklif = {
      ad, cekim, paket, yer, tarih, fiyat, aciklama, referans, bugun,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    };

    try {
      if (firebaseConnected) {
        const docRef = await db.collection('teklifler').add(teklif);
        teklif.id = docRef.id;
      } else {
        teklif.id = Date.now().toString();
      }
      
      teklifler.unshift(teklif);
      filtreliTeklifler = [...teklifler];
      renderTeklifler();

      document.getElementById("output").innerHTML = `
        <div style="color: green; padding: 10px; border: 1px solid green; border-radius: 5px;">
          ‚úÖ Teklif ba≈üarƒ±yla olu≈üturuldu!
        </div>
      `;

      // Formu temizle
      ["ad", "cekim", "paket", "yer", "tarih", "fiyat", "aciklama", "referans"].forEach(id => {
        document.getElementById(id).value = "";
      });

    } catch (error) {
      console.error("Teklif kaydetme hatasƒ±:", error);
      document.getElementById("output").innerHTML = `
        <div style="color: red; padding: 10px; border: 1px solid red; border-radius: 5px;">
          ‚ùå Teklif kaydedilirken hata olu≈ütu: ${error.message}
        </div>
      `;
    } finally {
      btn.disabled = false;
      btn.innerHTML = 'TEKLƒ∞Fƒ∞ OLU≈ûTUR';
    }
  }

  // Yeni liste tasarƒ±mƒ±yla teklifleri render et
  function renderTeklifler() {
    const container = document.getElementById("tekliflerListesi");
    
    if (filtreliTeklifler.length === 0) {
      container.innerHTML = '<div class="empty-state">Hen√ºz teklif bulunmamaktadƒ±r.</div>';
      return;
    }

    let html = `
      <div class="list-header">
        <div>M√º≈üteri / √áekim</div>
        <div>Paket</div>
        <div>Yer</div>
        <div>Tarih</div>
        <div>Fiyat</div>
        <div>ƒ∞≈ülemler</div>
      </div>
    `;

    filtreliTeklifler.forEach(teklif => {
      const cekimKisa = teklif.cekim.replace(/<br>/g, ', ').replace(/- /g, '').substring(0, 30) + '...';
      html += `
        <div class="list-item">
          <div>
            <strong>${teklif.ad}</strong><br>
            <small style="color: #666;">${cekimKisa}</small>
          </div>
          <div>${teklif.paket}</div>
          <div>${teklif.yer}</div>
          <div>${teklif.tarih}</div>
          <div><strong>${teklif.fiyat} TL</strong></div>
          <div class="list-actions">
            <button onclick="teklifiGoster('${teklif.id}')" class="btn-view" title="G√∂r√ºnt√ºle">üëÅ</button>
            <button onclick="pdfOlusturVePaylas('${teklif.id}')" class="btn-pdf" title="PDF">üìÑ</button>
            <button onclick="teklifiDuzenle('${teklif.id}')" class="btn-edit" title="D√ºzenle">‚úè</button>
            <button onclick="teklifiKabulEt('${teklif.id}')" class="btn-contract" title="S√∂zle≈üme">üìã</button>
			<button onclick="teklifiSil('${teklif.id}')" class="btn-delete" title="Sil">üóë</button>

          </div>
        </div>
      `;
    });

    container.innerHTML = html;
  }

  // Yeni liste tasarƒ±mƒ±yla s√∂zle≈ümeleri render et
  function renderSozlesmeler() {
    const container = document.getElementById("sozlesmelerListesi");
    
    if (filtreliSozlesmeler.length === 0) {
      container.innerHTML = '<div class="empty-state">Hen√ºz s√∂zle≈üme bulunmamaktadƒ±r.</div>';
      return;
    }
	googleTakvimGirisYap(() => {
  googleTakvimeEkle(sozlesme, '11'); // kƒ±rmƒ±zƒ±
});

    let html = `
      <div class="list-header">
        <div>M√º≈üteri / √áekim</div>
        <div>Paket</div>
        <div>Yer</div>
        <div>Tarih</div>
        <div>Fiyat</div>
        <div>ƒ∞≈ülemler</div>
      </div>
    `;

    filtreliSozlesmeler.forEach(sozlesme => {
      const cekimKisa = sozlesme.cekim.replace(/<br>/g, ', ').replace(/- /g, '').substring(0, 30) + '...';
      html += `
        <div class="list-item">
          <div>
            <strong>${sozlesme.ad}</strong><br>
            <small style="color: #666;">${cekimKisa}</small>
          </div>
          <div>${sozlesme.paket}</div>
          <div>${sozlesme.yer}</div>
          <div>${sozlesme.tarih}</div>
          <div><strong>${sozlesme.fiyat} TL</strong></div>
          <div class="list-actions">
            <button onclick="sozlesmeGoster('${sozlesme.id}')" class="btn-view" title="G√∂r√ºnt√ºle">üëÅ</button>
            <button onclick="sozlesmePdfOlustur('${sozlesme.id}')" class="btn-pdf" title="PDF">üìÑ</button>
            <button onclick="sozlesmeSil('${sozlesme.id}')" class="btn-delete" title="Sil">üóë</button>
          </div>
        </div>
      `;
    });

    container.innerHTML = html;
  }

  // Arama fonksiyonlarƒ±
  function teklifAra() {
    const arama = document.getElementById('teklifArama').value.toLowerCase().trim();
    
    if (!arama) {
      filtreliTeklifler = [...teklifler];
    } else {
      filtreliTeklifler = teklifler.filter(teklif => 
        teklif.ad.toLowerCase().includes(arama) ||
        teklif.cekim.toLowerCase().includes(arama) ||
        teklif.paket.toLowerCase().includes(arama) ||
        teklif.yer.toLowerCase().includes(arama)
      );
    }
    
    renderTeklifler();
  }

  function sozlesmeAra() {
    const arama = document.getElementById('sozlesmeArama').value.toLowerCase().trim();
    
    if (!arama) {
      filtreliSozlesmeler = [...sozlesmeler];
    } else {
      filtreliSozlesmeler = sozlesmeler.filter(sozlesme => 
        sozlesme.ad.toLowerCase().includes(arama) ||
        sozlesme.cekim.toLowerCase().includes(arama) ||
        sozlesme.paket.toLowerCase().includes(arama) ||
        sozlesme.yer.toLowerCase().includes(arama)
      );
    }
    
    renderSozlesmeler();
  }

  function aramaTemizle(tip) {
    if (tip === 'teklif') {
      document.getElementById('teklifArama').value = '';
      filtreliTeklifler = [...teklifler];
      renderTeklifler();
    } else {
      document.getElementById('sozlesmeArama').value = '';
      filtreliSozlesmeler = [...sozlesmeler];
      renderSozlesmeler();
    }
  }

 // Enter tu≈üu ile arama - devam eden kƒ±sƒ±m
  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('teklifArama').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        teklifAra();
      }
    });
    
    document.getElementById('sozlesmeArama').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        sozlesmeAra();
      }
    });
  });

  function teklifiGoster(id) {
    const teklif = teklifler.find(t => t.id === id);
    if (!teklif) return;

    document.getElementById("output").innerHTML = `
      <div style="padding: 20px; border: 2px solid #007bff; border-radius: 10px; background: #f8f9fa;">
        <h3 style="color: #007bff; text-align: center; margin-bottom: 20px;">TEKLƒ∞F DETAYI</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div><strong>M√º≈üteri:</strong> ${teklif.ad}</div>
          <div><strong>Paket:</strong> ${teklif.paket}</div>
          <div><strong>Etkinlik Yeri:</strong> ${teklif.yer}</div>
          <div><strong>Tarih:</strong> ${teklif.tarih}</div>
          <div><strong>Fiyat:</strong> ${teklif.fiyat} TL</div>
          <div><strong>Teklif Tarihi:</strong> ${teklif.bugun}</div>
        </div>
        <div style="margin-top: 15px;">
          <div><strong>√áekim T√ºr√º:</strong></div>
          <div style="margin-left: 10px;">${teklif.cekim}</div>
        </div>
        <div style="margin-top: 15px;">
          <div><strong>A√ßƒ±klama:</strong></div>
          <div style="margin-left: 10px;">${teklif.aciklama}</div>
        </div>
        ${teklif.referans ? `<div style="margin-top: 15px;"><strong>Referans:</strong> ${teklif.referans}</div>` : ''}
      </div>
    `;
  }


async function teklifiSil(id) {
  const teklif = teklifler.find(t => t.id === id);
  if (!teklif) return;

  if (!confirm(`${teklif.ad} m√º≈üterisinin teklifini silmek istediƒüinizden emin misiniz?`)) {
    return;
  }

  try {
    if (firebaseConnected) {
      await db.collection('teklifler').doc(id).delete();
    }

    teklifler = teklifler.filter(t => t.id !== id);
    filtreliTeklifler = [...teklifler];
    renderTeklifler();

    document.getElementById("output").innerHTML = `
      <div style="color: green; padding: 10px; border: 1px solid green; border-radius: 5px;">
        ‚úÖ Teklif ba≈üarƒ±yla silindi!
      </div>
    `;
  } catch (error) {
    console.error("Silme hatasƒ±:", error);
    document.getElementById("output").innerHTML = `
      <div style="color: red; padding: 10px; border: 1px solid red; border-radius: 5px;">
        ‚ùå Teklif silinirken hata olu≈ütu: ${error.message}
      </div>
    `;
  }
}


  function sozlesmeGoster(id) {
    const sozlesme = sozlesmeler.find(s => s.id === id);
    if (!sozlesme) return;

    document.getElementById("output").innerHTML = `
      <div style="padding: 20px; border: 2px solid #28a745; border-radius: 10px; background: #f8fff8;">
        <h3 style="color: #28a745; text-align: center; margin-bottom: 20px;">S√ñZLE≈ûME DETAYI</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div><strong>M√º≈üteri:</strong> ${sozlesme.ad}</div>
          <div><strong>Paket:</strong> ${sozlesme.paket}</div>
          <div><strong>Etkinlik Yeri:</strong> ${sozlesme.yer}</div>
          <div><strong>Tarih:</strong> ${sozlesme.tarih}</div>
          <div><strong>Fiyat:</strong> ${sozlesme.fiyat} TL</div>
          <div><strong>S√∂zle≈üme Tarihi:</strong> ${sozlesme.bugun}</div>
        </div>
        <div style="margin-top: 15px;">
          <div><strong>√áekim T√ºr√º:</strong></div>
          <div style="margin-left: 10px;">${sozlesme.cekim}</div>
        </div>
        <div style="margin-top: 15px;">
          <div><strong>A√ßƒ±klama:</strong></div>
          <div style="margin-left: 10px;">${sozlesme.aciklama}</div>
        </div>
        ${sozlesme.referans ? `<div style="margin-top: 15px;"><strong>Referans:</strong> ${sozlesme.referans}</div>` : ''}
      </div>
    `;
  }

  function teklifiDuzenle(id) {
    const teklif = teklifler.find(t => t.id === id);
    if (!teklif) return;

    duzenlenenTeklifId = id;

    // Formu doldur
    document.getElementById("editAd").value = teklif.ad;
    document.getElementById("editCekim").value = teklif.cekim.replace(/<br>/g, '\n').replace(/- /g, '');
    document.getElementById("editPaket").value = teklif.paket.toLowerCase();
    document.getElementById("editYer").value = teklif.yer;
    document.getElementById("editTarih").value = teklif.tarih;
    document.getElementById("editFiyat").value = teklif.fiyat;
    document.getElementById("editAciklama").value = teklif.aciklama.replace(/<br>/g, '\n');
    document.getElementById("editReferans").value = teklif.referans || '';

    // Formu g√∂ster
    document.getElementById("editForm").style.display = "block";
    document.getElementById("editForm").scrollIntoView({ behavior: 'smooth' });
  }

  async function kaydetDuzenleme() {
    if (!duzenlenenTeklifId) return;

    const ad = document.getElementById("editAd").value.trim();
    if (!ad) {
      alert("M√º≈üteri adƒ± bo≈ü bƒ±rakƒ±lamaz!");
      return;
    }

    const cekim = document.getElementById("editCekim").value
      .split('\n')
      .map(c => c.trim())
      .filter(Boolean)
      .map(c => `- ${c}`)
      .join('<br>');
    const paket = document.getElementById("editPaket").value.toUpperCase();
    const yer = document.getElementById("editYer").value;
    const tarih = document.getElementById("editTarih").value;
    const fiyat = document.getElementById("editFiyat").value;
    const aciklama = document.getElementById("editAciklama").value.replace(/\n/g, '<br>');
    const referans = document.getElementById("editReferans").value;

    try {
      // Firebase'de g√ºncelle
      if (firebaseConnected) {
        await db.collection('teklifler').doc(duzenlenenTeklifId).update({
          ad, cekim, paket, yer, tarih, fiyat, aciklama, referans
        });
      }

      // Yerel listede g√ºncelle
      const index = teklifler.findIndex(t => t.id === duzenlenenTeklifId);
      if (index !== -1) {
        teklifler[index] = { ...teklifler[index], ad, cekim, paket, yer, tarih, fiyat, aciklama, referans };
        filtreliTeklifler = [...teklifler];
        renderTeklifler();
      }

      document.getElementById("output").innerHTML = `
        <div style="color: green; padding: 10px; border: 1px solid green; border-radius: 5px;">
          ‚úÖ Teklif ba≈üarƒ±yla g√ºncellendi!
        </div>
      `;

      iptalDuzenleme();

    } catch (error) {
      console.error("G√ºncelleme hatasƒ±:", error);
      document.getElementById("output").innerHTML = `
        <div style="color: red; padding: 10px; border: 1px solid red; border-radius: 5px;">
          ‚ùå G√ºncelleme hatasƒ±: ${error.message}
        </div>
      `;
    }
  }

  function iptalDuzenleme() {
    document.getElementById("editForm").style.display = "none";
    duzenlenenTeklifId = null;
  }

  async function teklifiKabulEt(id) {
    const teklif = teklifler.find(t => t.id === id);
    if (!teklif) return;

    if (!confirm(`${teklif.ad} m√º≈üterisinin teklifini s√∂zle≈ümeye d√∂n√º≈üt√ºrmek istediƒüinizden emin misiniz?`)) {
      return;
    }

    try {
      const sozlesme = {
        ...teklif,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      };
      delete sozlesme.id;

      if (firebaseConnected) {
        const docRef = await db.collection('sozlesmeler').add(sozlesme);
        sozlesme.id = docRef.id;
      } else {
        sozlesme.id = Date.now().toString();
      }

      sozlesmeler.unshift(sozlesme);
      filtreliSozlesmeler = [...sozlesmeler];
      renderSozlesmeler();

      document.getElementById("output").innerHTML = `
        <div style="color: green; padding: 10px; border: 1px solid green; border-radius: 5px;">
          ‚úÖ Teklif ba≈üarƒ±yla s√∂zle≈ümeye d√∂n√º≈üt√ºr√ºld√º!
        </div>
      `;

    } catch (error) {
      console.error("S√∂zle≈üme olu≈üturma hatasƒ±:", error);
      document.getElementById("output").innerHTML = `
        <div style="color: red; padding: 10px; border: 1px solid red; border-radius: 5px;">
          ‚ùå S√∂zle≈üme olu≈üturulurken hata: ${error.message}
        </div>
      `;
    }
  }

  async function sozlesmeSil(id) {
    const sozlesme = sozlesmeler.find(s => s.id === id);
    if (!sozlesme) return;

    if (!confirm(`${sozlesme.ad} m√º≈üterisinin s√∂zle≈ümesini silmek istediƒüinizden emin misiniz?`)) {
      return;
    }

    try {
      if (firebaseConnected) {
        await db.collection('sozlesmeler').doc(id).delete();
      }

      sozlesmeler = sozlesmeler.filter(s => s.id !== id);
      filtreliSozlesmeler = [...sozlesmeler];
      renderSozlesmeler();

      document.getElementById("output").innerHTML = `
        <div style="color: green; padding: 10px; border: 1px solid green; border-radius: 5px;">
          ‚úÖ S√∂zle≈üme ba≈üarƒ±yla silindi!
        </div>
      `;

    } catch (error) {
      console.error("Silme hatasƒ±:", error);
      document.getElementById("output").innerHTML = `
        <div style="color: red; padding: 10px; border: 1px solid red; border-radius: 5px;">
          ‚ùå Silme hatasƒ±: ${error.message}
        </div>
      `;
    }
  }

  function pdfOlusturVePaylas(id) {
    const teklif = teklifler.find(t => t.id === id);
    if (!teklif) return;

    const pdfContent = document.getElementById('pdfContent');
    pdfContent.innerHTML = `
      <div class="pdf-header">
        <img src="https://i.hizliresim.com/eqyhuxx.png" alt="Logo" />
        <h1 class="pdf-title">TEKLƒ∞F FORMU</h1>
      </div>
      
      <div class="pdf-body">
        <p><strong>M√º≈üteri Adƒ±:</strong> ${teklif.ad}</p>
        <p><strong>√áekim T√ºr√º:</strong></p>
        <div style="margin-left: 20px;">${teklif.cekim}</div>
        <p><strong>Paket:</strong> ${teklif.paket}</p>
        <p><strong>Etkinlik Yeri:</strong> ${teklif.yer}</p>
        <p><strong>Tarih:</strong> ${teklif.tarih}</p>
        <p><strong>Fiyat:</strong> ${teklif.fiyat} TL</p>
        <p><strong>A√ßƒ±klama:</strong></p>
        <div style="margin-left: 20px;">${teklif.aciklama}</div>
        ${teklif.referans ? `<p><strong>Referans:</strong> ${teklif.referans}</p>` : ''}
      </div>
      
      <div class="pdf-footer">
        <p>Teklif Tarihi: ${teklif.bugun}</p>
        <p>Bu teklif 30 g√ºn ge√ßerlidir.</p>
      </div>
    `;

    // PDF'i g√∂ster ve yazdƒ±r
    pdfContent.style.display = 'block';
    window.print();
    pdfContent.style.display = 'none';
  }

  function sozlesmePdfOlustur(id) {
    const sozlesme = sozlesmeler.find(s => s.id === id);
    if (!sozlesme) return;

    const pdfContent = document.getElementById('pdfContent');
    pdfContent.innerHTML = `
      <div class="pdf-header">
        <img src="https://i.hizliresim.com/eqyhuxx.png" alt="Logo" />
        <h1 class="pdf-title">S√ñZLE≈ûME</h1>
      </div>
      
      <div class="pdf-body">
        <p><strong>M√º≈üteri Adƒ±:</strong> ${sozlesme.ad}</p>
        <p><strong>√áekim T√ºr√º:</strong></p>
        <div style="margin-left: 20px;">${sozlesme.cekim}</div>
        <p><strong>Paket:</strong> ${sozlesme.paket}</p>
        <p><strong>Etkinlik Yeri:</strong> ${sozlesme.yer}</p>
        <p><strong>Tarih:</strong> ${sozlesme.tarih}</p>
        <p><strong>√úcret:</strong> ${sozlesme.fiyat} TL</p>
        <p><strong>Hizmet Detaylarƒ±:</strong></p>
        <div style="margin-left: 20px;">${sozlesme.aciklama}</div>
        ${sozlesme.referans ? `<p><strong>Referans:</strong> ${sozlesme.referans}</p>` : ''}
        
        <div style="margin-top: 40px;">
          <p><strong>S√∂zle≈üme ≈ûartlarƒ±:</strong></p>
          <ul style="margin-left: 20px;">
            <li>√úcretin %50'si pe≈üin, %50'si √ßekim g√ºn√º √∂denecektir.</li>
            <li>Hava ko≈üullarƒ± nedeniyle erteleme durumunda ek √ºcret alƒ±nmaz.</li>
            <li>Fotoƒüraflar 2 hafta i√ßinde teslim edilecektir.</li>
            <li>ƒ∞ptal durumunda pe≈üin √∂denen tutar iade edilmeyecektir.</li>
          </ul>
        </div>
        
        <div style="margin-top: 60px; display: flex; justify-content: space-between;">
          <div style="text-align: center;">
            <div style="border-bottom: 1px solid #000; width: 200px; margin-bottom: 5px;"></div>
            <strong>M√º≈üteri ƒ∞mzasƒ±</strong>
          </div>
          <div style="text-align: center;">
            <div style="border-bottom: 1px solid #000; width: 200px; margin-bottom: 5px;"></div>
            <strong>Fotoƒüraf√ßƒ± ƒ∞mzasƒ±</strong>
          </div>
        </div>
      </div>
      
      <div class="pdf-footer">
        <p>S√∂zle≈üme Tarihi: ${sozlesme.bugun}</p>
      </div>
    `;

    // PDF'i g√∂ster ve yazdƒ±r
    pdfContent.style.display = 'block';
    window.print();
    pdfContent.style.display = 'none';
	
  }
  
  // Google API ayarlarƒ±
const CLIENT_ID = '270944409412-g5p51bra8t2cedq1h3mrdobd4dtm871o.apps.googleusercontent.com'; // kendi client ID
const SCOPES = 'https://www.googleapis.com/auth/calendar';

function googleTakvimGirisYap(callback) {
  gapi.load('client:auth2', () => {
    gapi.client.init({
      clientId: CLIENT_ID,
      scope: SCOPES
    }).then(() => {
      const authInstance = gapi.auth2.getAuthInstance();
      if (!authInstance.isSignedIn.get()) {
        authInstance.signIn().then(callback);
      } else {
        callback();
      }
    });
  });
}

// Takvime etkinlik ekle
function googleTakvimeEkle(teklif, renkKodu = '9') {
  gapi.client.calendar.events.insert({
    calendarId: 'primary',
    resource: {
      summary: `Teklif: ${teklif.ad}`,
      description: teklif.aciklama,
      start: {
        date: teklif.tarih,
        timeZone: 'Europe/Istanbul'
      },
      end: {
        date: teklif.tarih,
        timeZone: 'Europe/Istanbul'
      },
      colorId: renkKodu
    }
  }).then(response => {
    console.log('Etkinlik eklendi:', response);
  }).catch(error => {
    console.error('Takvim ekleme hatasƒ±:', error);
  });
}


</script>
</body>
</html>
