<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Teklif OluÅŸtur ve YÃ¶net</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f5f7fa;
      margin: 0; padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    .logo {text-align:center; margin-bottom:20px;}
    .logo img {width: 150px;}
    h2 {text-align:center; color:#333; margin-bottom:30px;}
    label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      margin-bottom: 15px;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      background-color: #007bff;
      color: white;
      border: none;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover:not(:disabled) {
      background-color: #0056b3;
    }
    button:disabled {
      background-color: #999;
      cursor: not-allowed;
    }
    #output {
      margin-top: 30px;
      min-height: 180px;
    }

    /* Loading spinner */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #007bff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .loading-text {
      color: #666;
      font-style: italic;
      text-align: center;
      padding: 20px;
    }

    /* Firebase baÄŸlantÄ± durumu */
    .firebase-status {
      position: fixed;
      top: 10px;
      right: 10px;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 12px;
      font-weight: bold;
      z-index: 1000;
    }
    .firebase-connected {
      background-color: #28a745;
      color: white;
    }
    .firebase-disconnected {
      background-color: #dc3545;
      color: white;
    }

    /* Kart stil */
    .card-container {
      margin-top: 15px;
    }
    .card {
      background: #fff;
      border: 2px solid #007bff;
      border-radius: 10px;
      padding: 15px 20px;
      margin-bottom: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .card h3 {
      margin-top: 0;
      color: #007bff;
    }
    .card p {
      margin: 6px 0;
      color: #333;
    }
    .card button {
      margin-right: 10px;
      margin-top: 10px;
      width: auto;
      padding: 6px 14px;
      font-size: 14px;
    }

    /* Accordion MenÃ¼ */
    .accordion {
      background-color: #007bff;
      color: white;
      cursor: pointer;
      padding: 15px 20px;
      width: 100%;
      border: none;
      text-align: left;
      outline: none;
      font-size: 18px;
      border-radius: 8px;
      margin-top: 25px;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    .accordion:hover {
      background-color: #0056b3;
    }
    .accordion.active {
      background-color: #00408d;
    }
    .panel {
      padding: 0 20px 15px 20px;
      display: none;
      background-color: white;
      overflow: hidden;
      border: 1px solid #007bff;
      border-top: none;
      border-radius: 0 0 8px 8px;
    }

    /* Edit form styles */
    #editForm {
      background: #eef5ff;
      border: 2px solid #0056b3;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
    }
    #editForm label {
      font-weight: bold;
      margin-top: 5px;
    }
    #editForm button {
      width: 48%;
      margin-top: 10px;
    }
    #editForm .btn-cancel {
      background-color: #dc3545;
    }
    #editForm .btn-cancel:hover {
      background-color: #a71d2a;
    }

    /* PDF iÃ§in Ã¶zel stiller */
    .pdf-content {
      background: white;
      padding: 40px;
      margin: 20px;
      border: 1px solid #ddd;
      font-family: 'Segoe UI', Arial, sans-serif;
      line-height: 1.6;
      color: #333;
    }
    
    .pdf-header {
      text-align: center;
      margin-bottom: 30px;
      border-bottom: 2px solid #007bff;
      padding-bottom: 20px;
    }
    
    .pdf-header img {
      max-height: 80px;
      margin-bottom: 15px;
    }
    
    .pdf-title {
      color: #007bff;
      font-size: 24px;
      font-weight: bold;
      margin: 0;
    }
    
    .pdf-body {
      font-size: 16px;
    }
    
    .pdf-body p {
      margin: 12px 0;
    }
    
    .pdf-body strong {
      color: #007bff;
    }
    
    .pdf-footer {
      margin-top: 40px;
      text-align: center;
      font-size: 14px;
      color: #666;
      border-top: 1px solid #ddd;
      padding-top: 20px;
    }

    /* YazdÄ±r iÃ§in gizle */
    @media print {
      body * {
        visibility: hidden;
      }
      .pdf-content, .pdf-content * {
        visibility: visible;
      }
      .pdf-content {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        margin: 0;
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <!-- Firebase baÄŸlantÄ± durumu -->
  <div id="firebaseStatus" class="firebase-status firebase-disconnected">
    ğŸ”´ Firebase BaÄŸlanÄ±yor...
  </div>

  <div class="container">
    <div class="logo">
      <img src="https://i.hizliresim.com/eqyhuxx.png" alt="Logo" />
    </div>
    <h2>TEKLÄ°F OLUÅTUR</h2>

    <label>MÃ¼ÅŸteri AdÄ±</label>
    <input type="text" id="ad" />

    <label>Ã‡ekim TÃ¼rÃ¼</label>
    <input type="text" id="cekim" placeholder="Ã–rn: DÃ¼ÄŸÃ¼n, Save the Date, ÃœrÃ¼n" />

    <label>Paket SeÃ§imi</label>
    <select id="paket" onchange="paketBilgisiYukle()">
      <option value="">-- Paket SeÃ§in --</option>
      <option value="bronze">Bronze</option>
      <option value="silver">Silver</option>
      <option value="gold">Gold</option>
    </select>

    <label>Etkinlik Yeri</label>
    <input type="text" id="yer" placeholder="Ã–rn: Ä°stanbul, Kemerburgaz OrmanÄ±" />

    <label>Tarih</label>
    <input type="date" id="tarih" />

    <label>Fiyat (TL)</label>
    <input type="number" id="fiyat" />

    <label>AÃ§Ä±klama</label>
    <textarea id="aciklama" rows="3" placeholder="Detaylar..."></textarea>

    <label>Referans KiÅŸi</label>
    <input type="text" id="referans" placeholder="Seni Ã¶neren kiÅŸi (isteÄŸe baÄŸlÄ±)" />

    <button onclick="teklifHazirla()" id="teklifBtn">TEKLÄ°FÄ° OLUÅTUR</button>

    <div id="output"></div>

    <button class="accordion">Teklifler</button>
    <div class="panel" id="tekliflerPanel">
      <div id="tekliflerListesi" class="card-container"></div>
    </div>

    <button class="accordion">SÃ¶zleÅŸmeler</button>
    <div class="panel" id="sozlesmelerPanel">
      <div id="sozlesmelerListesi" class="card-container"></div>
    </div>

    <!-- DÃ¼zenleme Formu (gizli) -->
    <div id="editForm" style="display:none;">
      <h3>Teklifi DÃ¼zenle</h3>
      <label>MÃ¼ÅŸteri AdÄ±</label>
      <input type="text" id="editAd" />

      <label>Ã‡ekim TÃ¼rÃ¼</label>
      <input type="text" id="editCekim" placeholder="Ã–rn: DÃ¼ÄŸÃ¼n, Save the Date, ÃœrÃ¼n" />

      <label>Paket SeÃ§imi</label>
      <select id="editPaket" onchange="editPaketBilgisiYukle()">
        <option value="">-- Paket SeÃ§in --</option>
        <option value="bronze">Bronze</option>
        <option value="silver">Silver</option>
        <option value="gold">Gold</option>
      </select>

      <label>Etkinlik Yeri</label>
      <input type="text" id="editYer" placeholder="Ã–rn: Ä°stanbul, Kemerburgaz OrmanÄ±" />

      <label>Tarih</label>
      <input type="date" id="editTarih" />

      <label>Fiyat (TL)</label>
      <input type="number" id="editFiyat" />

      <label>AÃ§Ä±klama</label>
      <textarea id="editAciklama" rows="3" placeholder="Detaylar..."></textarea>

      <label>Referans KiÅŸi</label>
      <input type="text" id="editReferans" placeholder="Seni Ã¶neren kiÅŸi (isteÄŸe baÄŸlÄ±)" />

      <button onclick="kaydetDuzenleme()">Kaydet</button>
      <button class="btn-cancel" onclick="iptalDuzenleme()">Ä°ptal</button>
    </div>
  </div>

  <!-- PDF iÃ§eriÄŸi iÃ§in gizli div -->
  <div id="pdfContent" class="pdf-content" style="display:none;">
    <!-- PDF iÃ§eriÄŸi buraya dinamik olarak eklenecek -->
  </div>


<script>
 
// Firebase yapÄ±landÄ±rma bilgileri
        const firebaseConfig = {
            apiKey: "AIzaSyDMMpU1l8zabgaw7bfSHKCOxLbz-RhNT7I",
            authDomain: "databasepsv-dc1b7.firebaseapp.com",
            databaseURL: "https://databasepsv-dc1b7-default-rtdb.firebaseio.com",
            projectId: "databasepsv-dc1b7",
            storageBucket: "databasepsv-dc1b7.firebasestorage.app",
            messagingSenderId: "106474799557",
            appId: "1:106474799557:web:8f7cff2b7ef8466ab08bac",
            measurementId: "G-BKKE9YZS1T"
        };

        // Firebase baÅŸlatma
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

  try {
    firebase.initializeApp(firebaseConfig);
    db = firebase.firestore();
    firebaseConnected = true;
    updateFirebaseStatus(true);
    console.log("Firebase baÅŸarÄ±yla baÄŸlandÄ±!");
  } catch (error) {
    console.error("Firebase baÄŸlantÄ± hatasÄ±:", error);
    updateFirebaseStatus(false);
    // Firebase baÄŸlantÄ±sÄ± yoksa yerel depolama kullan
    alert("Firebase baÄŸlantÄ±sÄ± kurulamadÄ±. Veriler geÃ§ici olarak tarayÄ±cÄ±da saklanacak.");
  }

  function updateFirebaseStatus(connected) {
    const statusEl = document.getElementById('firebaseStatus');
    if (connected) {
      statusEl.textContent = 'ğŸŸ¢ Firebase BaÄŸlÄ±';
      statusEl.className = 'firebase-status firebase-connected';
    } else {
      statusEl.textContent = 'ğŸ”´ Firebase BaÄŸlantÄ±sÄ±z';
      statusEl.className = 'firebase-status firebase-disconnected';
    }
  }

  const paketler = {
    bronze: {
      fiyat: 3000,
      aciklama: "2 saat Ã§ekim, 30 dÃ¼zenlenmiÅŸ fotoÄŸraf, 1 dakikalÄ±k reels"
    },
    silver: {
      fiyat: 5000,
      aciklama: "4 saat Ã§ekim, 60 dÃ¼zenlenmiÅŸ fotoÄŸraf, 2 dakikalÄ±k klip"
    },
    gold: {
      fiyat: 8000,
      aciklama: "TÃ¼m gÃ¼n Ã§ekim, 100+ fotoÄŸraf, drone + 3 dakikalÄ±k klip"
    }
  };

  let teklifler = [];
  let sozlesmeler = [];
  let duzenlenenTeklifId = null;

  // Sayfa yÃ¼klendiÄŸinde verileri Ã§ek
  window.addEventListener('load', async () => {
    await veriCek();
  });

  // Firebase'den verileri Ã§ek
  async function veriCek() {
    if (!firebaseConnected) {
      console.log("Firebase baÄŸlantÄ±sÄ± yok, yerel veriler kullanÄ±lÄ±yor.");
      return;
    }

    try {
      showLoading("tekliflerListesi");
      showLoading("sozlesmelerListesi");

      // Teklifleri Ã§ek
      const teklifSnapshot = await db.collection('teklifler').orderBy('createdAt', 'desc').get();
      teklifler = [];
      teklifSnapshot.forEach(doc => {
        teklifler.push({
          id: doc.id,
          ...doc.data()
        });
      });

      // SÃ¶zleÅŸmeleri Ã§ek
      const sozlesmeSnapshot = await db.collection('sozlesmeler').orderBy('createdAt', 'desc').get();
      sozlesmeler = [];
      sozlesmeSnapshot.forEach(doc => {
        sozlesmeler.push({
          id: doc.id,
          ...doc.data()
        });
      });

      renderTeklifler();
      renderSozlesmeler();
    } catch (error) {
      console.error("Veri Ã§ekme hatasÄ±:", error);
      document.getElementById('output').innerHTML = `
        <div style="color: red; padding: 10px; border: 1px solid red; border-radius: 5px;">
          âŒ Veriler yÃ¼klenirken hata oluÅŸtu: ${error.message}
        </div>
      `;
    }
  }

  function showLoading(containerId) {
    document.getElementById(containerId).innerHTML = `
      <div class="loading-text">
        <div class="loading"></div>
        Veriler yÃ¼kleniyor...
      </div>
    `;
  }

  // Accordion aÃ§/kapa
  document.querySelectorAll(".accordion").forEach(button => {
    button.addEventListener("click", () => {
      button.classList.toggle("active");
      const panel = button.nextElementSibling;
      if(panel.style.display === "block") {
        panel.style.display = "none";
      } else {
        panel.style.display = "block";
      }
    });
  });

  function paketBilgisiYukle() {
    const secilen = document.getElementById("paket").value;
    if (paketler[secilen]) {
      document.getElementById("fiyat").value = paketler[secilen].fiyat;
      document.getElementById("aciklama").value = paketler[secilen].aciklama;
    }
  }

  function editPaketBilgisiYukle() {
    const secilen = document.getElementById("editPaket").value;
    if (paketler[secilen]) {
      document.getElementById("editFiyat").value = paketler[secilen].fiyat;
      document.getElementById("editAciklama").value = paketler[secilen].aciklama;
    }
  }

  async function teklifHazirla() {
    const ad = document.getElementById("ad").value.trim();
    if (!ad) {
      alert("MÃ¼ÅŸteri adÄ± boÅŸ bÄ±rakÄ±lamaz!");
      return;
    }

    const btn = document.getElementById("teklifBtn");
    btn.disabled = true;
    btn.innerHTML = '<div class="loading"></div> Teklif OluÅŸturuluyor...';

    const cekim = document.getElementById("cekim").value
      .split(',')
      .map(c => c.trim())
      .filter(Boolean)
      .map(c => `- ${c}`)
      .join('<br>');
    const paket = document.getElementById("paket").value.toUpperCase();
    const yer = document.getElementById("yer").value;
    const tarih = document.getElementById("tarih").value;
    const fiyat = document.getElementById("fiyat").value;
    const aciklama = document.getElementById("aciklama").value.replace(/\n/g, '<br>');
    const referans = document.getElementById("referans").value;
    const bugun = new Date().toLocaleDateString('tr-TR');

    const teklif = {
      ad, cekim, paket, yer, tarih, fiyat, aciklama, referans, bugun,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    };

    try {
      if (firebaseConnected) {
        // Firebase'e kaydet
        const docRef = await db.collection('teklifler').add(teklif);
        teklif.id = docRef.id;
      } else {
        // Yerel olarak kaydet
        teklif.id = Date.now().toString();
      }
      
      teklifler.unshift(teklif);
      renderTeklifler();

      document.getElementById("output").innerHTML = `
        <div style="color: green; padding: 10px; border: 1px solid green; border-radius: 5px;">
          âœ… Teklif baÅŸarÄ±yla oluÅŸturuldu!
        </div>
      `;

      // Formu temizle
      ["ad", "cekim", "paket", "yer", "tarih", "fiyat", "aciklama", "referans"].forEach(id => {
        document.getElementById(id).value = "";
      });

    } catch (error) {
      console.error("Teklif kaydetme hatasÄ±:", error);
      document.getElementById("output").innerHTML = `
        <div style="color: red; padding: 10px; border: 1px solid red; border-radius: 5px;">
          âŒ Teklif kaydedilirken hata oluÅŸtu: ${error.message}
        </div>
      `;
    } finally {
      btn.disabled = false;
      btn.innerHTML = 'TEKLÄ°FÄ° OLUÅTUR';
    }
  }

  function renderTeklifler() {
    const container = document.getElementById("tekliflerListesi");
    
    if (teklifler.length === 0) {
      container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">HenÃ¼z teklif bulunmamaktadÄ±r.</p>';
      return;
    }

    container.innerHTML = "";
    teklifler.forEach(teklif => {
      const card = document.createElement("div");
      card.className = "card";

      card.innerHTML = `
        <h3>${teklif.ad}</h3>
        <p><strong>Ã‡ekim TÃ¼rÃ¼:</strong><br>${teklif.cekim}</p>
        <p><strong>Paket:</strong> ${teklif.paket}</p>
        <p><strong>Etkinlik Yeri:</strong> ${teklif.yer}</p>
        <p><strong>Tarih:</strong> ${teklif.tarih}</p>
        <p><strong>Fiyat:</strong> ${teklif.fiyat} TL</p>
        <button onclick="teklifiGoster('${teklif.id}')">Teklifi GÃ¶ster</button>
        <button onclick="pdfOlusturVePaylas('${teklif.id}')">PDF Kaydet ve PaylaÅŸ</button>
        <button onclick="teklifiDuzenle('${teklif.id}')">DÃ¼zenle</button>
        <button onclick="teklifiKabulEt('${teklif.id}')">SÃ¶zleÅŸmeye DÃ¶nÃ¼ÅŸtÃ¼r</button>
      `;

      container.appendChild(card);
    });
  }

  function teklifiGoster(id) {
    const teklif = teklifler.find(t => t.id === id);
    if (!teklif) return alert("Teklif bulunamadÄ±.");

    const html = `
      <div style="border:2px solid #007bff; padding:20px; border-radius:10px; max-width:700px; margin:auto; background:#fff;">
        <div style="text-align:center; margin-bottom:20px;">
          <img src='https://i.hizliresim.com/eqyhuxx.png' style="max-height:80px;">
          <h2 style="color:#007bff; margin:10px 0;">ğŸ“¸ FOTOÄRAFÃ‡ILIK HÄ°ZMET TEKLÄ°FÄ°</h2>
        </div>
        <div style="font-size:16px; color:#333; line-height:1.6;">
          <p><strong>ğŸ‘¤ MÃ¼ÅŸteri:</strong> ${teklif.ad}</p>
          <p><strong>ğŸ“· Ã‡ekim TÃ¼rÃ¼:</strong><br>${teklif.cekim}</p>
          <p><strong>ğŸ“¦ Paket:</strong> ${teklif.paket}</p>
          <p><strong>ğŸ“ Etkinlik Yeri:</strong> ${teklif.yer}</p>
          <p><strong>ğŸ“… Tarih:</strong> ${teklif.tarih}</p>
          <p><strong>ğŸ’° Fiyat:</strong> ${teklif.fiyat} TL</p>
          <p><strong>ğŸ“ AÃ§Ä±klama:</strong><br>${teklif.aciklama}</p>
          ${teklif.referans && teklif.referans.trim() !== "" ? `<p><strong>ğŸ‘¥ Referans:</strong> ${teklif.referans}</p>` : ""}
        </div>
        <div style="margin-top:30px; text-align:center; font-size:14px; color:#666;">
          Bu teklif <strong>${teklif.bugun}</strong> tarihinde hazÄ±rlanmÄ±ÅŸtÄ±r.<br>
          FotoÄŸrafÃ§Ä±: <strong>PASOVART</strong> | TÃ¼m haklarÄ± saklÄ±dÄ±r.
        </div>
      </div>
    `;
    document.getElementById("output").innerHTML = html;
  }

  function pdfOlusturVePaylas(id) {
    const teklif = teklifler.find(t => t.id === id);
    if (!teklif) return alert("Teklif bulunamadÄ±.");

    // PDF iÃ§eriÄŸini hazÄ±rla
    const pdfContent = document.getElementById("pdfContent");
    pdfContent.innerHTML = `
      <div class="pdf-header">
        <img src="https://i.hizliresim.com/eqyhuxx.png" alt="Logo">
        <h1 class="pdf-title">ğŸ“¸ FOTOÄRAFÃ‡ILIK HÄ°ZMET TEKLÄ°FÄ°</h1>
      </div>
      <div class="pdf-body">
        <p><strong>ğŸ‘¤ MÃ¼ÅŸteri:</strong> ${teklif.ad}</p>
        <p><strong>ğŸ“· Ã‡ekim TÃ¼rÃ¼:</strong><br>${teklif.cekim}</p>
        <p><strong>ğŸ“¦ Paket:</strong> ${teklif.paket}</p>
        <p><strong>ğŸ“ Etkinlik Yeri:</strong> ${teklif.yer}</p>
        <p><strong>ğŸ“… Tarih:</strong> ${teklif.tarih}</p>
        <p><strong>ğŸ’° Fiyat:</strong> ${teklif.fiyat} TL</p>
        <p><strong>ğŸ“ AÃ§Ä±klama:</strong><br>${teklif.aciklama}</p>
        ${teklif.referans && teklif.referans.trim() !== "" ? `<p><strong>ğŸ‘¥ Referans:</strong> ${teklif.referans}</p>` : ""}
      </div>
      <div class="pdf-footer">
        <p>Bu teklif <strong>${teklif.bugun}</strong> tarihinde hazÄ±rlanmÄ±ÅŸtÄ±r.</p>
        <p>FotoÄŸrafÃ§Ä±: <strong>PASOVART</strong> | TÃ¼m haklarÄ± saklÄ±dÄ±r.</p>
      </div>
    `;

    // PDF'i gÃ¶ster ve yazdÄ±r menÃ¼sÃ¼nÃ¼ aÃ§
    pdfContent.style.display = "block";
    
    // KÄ±sa bir sÃ¼re bekle ki iÃ§erik yÃ¼klensin
    setTimeout(() => {
      window.print();
      
      // YazdÄ±rdÄ±ktan sonra WhatsApp paylaÅŸÄ±mÄ±nÄ± sor
      setTimeout(() => {
        pdfContent.style.display = "none";
        
        if (confirm("PDF kaydedildi! Åimdi WhatsApp'ta paylaÅŸmak ister misiniz?")) {
          whatsappPaylas(id);
        }
      }, 1000);
    }, 500);
  }

  function whatsappPaylas(id) {
    const teklif = teklifler.find(t => t.id === id);
    if (!teklif) return alert("Teklif bulunamadÄ±.");
    
    // WhatsApp mesaj metni hazÄ±rlama
    let mesaj = `ğŸ“¸ FotoÄŸrafÃ§Ä±lÄ±k Hizmet Teklifi\n\n`;
    mesaj += `MÃ¼ÅŸteri: ${teklif.ad}\n`;
    mesaj += `Ã‡ekim TÃ¼rÃ¼: ${teklif.cekim.replace(/<br>/g, ', ').replace(/- /g,'')}\n`;
    mesaj += `Paket: ${teklif.paket}\n`;
    mesaj += `Etkinlik Yeri: ${teklif.yer}\n`;
    mesaj += `Tarih: ${teklif.tarih}\n`;
    mesaj += `Fiyat: ${teklif.fiyat} TL\n`;
    mesaj += `AÃ§Ä±klama: ${teklif.aciklama.replace(/<br>/g, '\n')}\n`;
    if (teklif.referans && teklif.referans.trim() !== "") {
      mesaj += `Referans: ${teklif.referans}\n`;
    }
    mesaj += `\nğŸ“„ DetaylÄ± teklif PDF'i ekte gÃ¶nderilmiÅŸtir.\n\nFotoÄŸrafÃ§Ä±: Ferdi KabalÄ±`;

    const url = `https://wa.me/?text=${encodeURIComponent(mesaj)}`;
    window.open(url, '_blank');
  }

  function teklifiDuzenle(id) {
    const teklif = teklifler.find(t => t.id === id);
    if(!teklif) return alert("Teklif bulunamadÄ±.");

    duzenlenenTeklifId = id;

    // AÃ§Ä±k panel varsa kapat (opsiyonel)
    document.getElementById("output").innerHTML = "";

    // DÃ¼zenleme formunu gÃ¶ster ve alanlarÄ± doldur
    document.getElementById("editAd").value = teklif.ad;
    document.getElementById("editCekim").value = teklif.cekim.replace(/- /g, '').replace(/<br>/g, ', ');
    document.getElementById("editPaket").value = teklif.paket.toLowerCase();
    document.getElementById("editYer").value = teklif.yer;
    document.getElementById("editTarih").value = teklif.tarih;
    document.getElementById("editFiyat").value = teklif.fiyat;
    document.getElementById("editAciklama").value = teklif.aciklama.replace(/<br>/g, '\n');
    document.getElementById("editReferans").value = teklif.referans;

    document.getElementById("editForm").style.display = "block";
    window.scrollTo({top: 0, behavior: 'smooth'});
  }

  function kaydetDuzenleme() {
    if(duzenlenenTeklifId === null) return;

    const ad = document.getElementById("editAd").value.trim();
    if (!ad) {
      alert("MÃ¼ÅŸteri adÄ± boÅŸ bÄ±rakÄ±lamaz!");
      return;
    }

    const cekim = document.getElementById("editCekim").value
      .split(',')
      .map(c => c.trim())
      .filter(Boolean)
      .map(c => `- ${c}`)
      .join('<br>');
    const paket = document.getElementById("editPaket").value.toUpperCase();
    const yer = document.getElementById("editYer").value;
    const tarih = document.getElementById("editTarih").value;
    const fiyat = document.getElementById("editFiyat").value;
    const aciklama = document.getElementById("editAciklama").value.replace(/\n/g, '<br>');
    const referans = document.getElementById("editReferans").value;

    const index = teklifler.findIndex(t => t.id === duzenlenenTeklifId);
    if (index !== -1) {
      teklifler[index] = {
        ...teklifler[index],
        ad, cekim, paket, yer, tarih, fiyat, aciklama, referans
      };
    }

    duzenlenenTeklifId = null;
    document.getElementById("editForm").style.display = "none";
    document.getElementById("output").innerHTML = "Teklif baÅŸarÄ±yla gÃ¼ncellendi.";

    renderTeklifler();
  }

  function iptalDuzenleme() {
    duzenlenenTeklifId = null;
    document.getElementById("editForm").style.display = "none";
  }

  function teklifiKabulEt(id) {
    const teklif = teklifler.find(t => t.id === id);
    if (!teklif) return alert("Teklif bulunamadÄ±.");

    sozlesmeler.push(teklif);
    teklifler = teklifler.filter(t => t.id !== id);
    document.getElementById("output").innerHTML = "Teklif sÃ¶zleÅŸmeye dÃ¶nÃ¼ÅŸtÃ¼rÃ¼ldÃ¼.";

    renderTeklifler();
    renderSozlesmeler();
  }

  function renderSozlesmeler() {
    const container = document.getElementById("sozlesmelerListesi");
    container.innerHTML = "";
    sozlesmeler.forEach(soz => {
      const card = document.createElement("div");
      card.className = "card";

      card.innerHTML = `
        <h3>${soz.ad}</h3>
        <p><strong>Ã‡ekim TÃ¼rÃ¼:</strong><br>${soz.cekim}</p>
        <p><strong>Paket:</strong> ${soz.paket}</p>
        <p><strong>Tarih:</strong> ${soz.tarih}</p>
        <p><strong>Fiyat:</strong> ${soz.fiyat} TL</p>
      `;

      container.appendChild(card);
    });
  }
</script>

</body>
</html>
