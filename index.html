<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Teklif Oluştur ve Yönet</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f5f7fa;
      margin: 0; padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    .logo {text-align:center; margin-bottom:20px;}
    .logo img {width: 150px;}
    h2 {text-align:center; color:#333; margin-bottom:30px;}
    label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      margin-bottom: 15px;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      background-color: #007bff;
      color: white;
      border: none;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover:not(:disabled) {
      background-color: #0056b3;
    }
    button:disabled {
      background-color: #999;
      cursor: not-allowed;
    }
    #output {
      margin-top: 30px;
      min-height: 180px;
    }

    /* Kart stil */
    .card-container {
      margin-top: 15px;
    }
    .card {
      background: #fff;
      border: 2px solid #007bff;
      border-radius: 10px;
      padding: 15px 20px;
      margin-bottom: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .card h3 {
      margin-top: 0;
      color: #007bff;
    }
    .card p {
      margin: 6px 0;
      color: #333;
    }
    .card button {
      margin-right: 10px;
      margin-top: 10px;
      width: auto;
      padding: 6px 14px;
      font-size: 14px;
    }

    /* Accordion Menü */
    .accordion {
      background-color: #007bff;
      color: white;
      cursor: pointer;
      padding: 15px 20px;
      width: 100%;
      border: none;
      text-align: left;
      outline: none;
      font-size: 18px;
      border-radius: 8px;
      margin-top: 25px;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    .accordion:hover {
      background-color: #0056b3;
    }
    .accordion.active {
      background-color: #00408d;
    }
    .panel {
      padding: 0 20px 15px 20px;
      display: none;
      background-color: white;
      overflow: hidden;
      border: 1px solid #007bff;
      border-top: none;
      border-radius: 0 0 8px 8px;
    }

    /* Edit form styles */
    #editForm {
      background: #eef5ff;
      border: 2px solid #0056b3;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
    }
    #editForm label {
      font-weight: bold;
      margin-top: 5px;
    }
    #editForm button {
      width: 48%;
      margin-top: 10px;
    }
    #editForm .btn-cancel {
      background-color: #dc3545;
    }
    #editForm .btn-cancel:hover {
      background-color: #a71d2a;
    }

    /* PDF için özel stiller */
    .pdf-content {
      background: white;
      padding: 40px;
      margin: 20px;
      border: 1px solid #ddd;
      font-family: 'Segoe UI', Arial, sans-serif;
      line-height: 1.6;
      color: #333;
    }
    
    .pdf-header {
      text-align: center;
      margin-bottom: 30px;
      border-bottom: 2px solid #007bff;
      padding-bottom: 20px;
    }
    
    .pdf-header img {
      max-height: 80px;
      margin-bottom: 15px;
    }
    
    .pdf-title {
      color: #007bff;
      font-size: 24px;
      font-weight: bold;
      margin: 0;
    }
    
    .pdf-body {
      font-size: 16px;
    }
    
    .pdf-body p {
      margin: 12px 0;
    }
    
    .pdf-body strong {
      color: #007bff;
    }
    
    .pdf-footer {
      margin-top: 40px;
      text-align: center;
      font-size: 14px;
      color: #666;
      border-top: 1px solid #ddd;
      padding-top: 20px;
    }

    /* Yazdır için gizle */
    @media print {
      body * {
        visibility: hidden;
      }
      .pdf-content, .pdf-content * {
        visibility: visible;
      }
      .pdf-content {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        margin: 0;
        padding: 20px;
      }
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="logo">
      <img src="https://i.hizliresim.com/eqyhuxx.png" alt="Logo" />
    </div>
    <h2>TEKLİF OLUŞTUR</h2>

    <label>Müşteri Adı</label>
    <input type="text" id="ad" />

    <label>Çekim Türü</label>
    <input type="text" id="cekim" placeholder="Örn: Düğün, Save the Date, Ürün" />

    <label>Paket Seçimi</label>
    <select id="paket" onchange="paketBilgisiYukle()">
      <option value="">-- Paket Seçin --</option>
      <option value="bronze">Bronze</option>
      <option value="silver">Silver</option>
      <option value="gold">Gold</option>
    </select>

    <label>Etkinlik Yeri</label>
    <input type="text" id="yer" placeholder="Örn: İstanbul, Kemerburgaz Ormanı" />

    <label>Tarih</label>
    <input type="date" id="tarih" />

    <label>Fiyat (TL)</label>
    <input type="number" id="fiyat" />

    <label>Açıklama</label>
    <textarea id="aciklama" rows="3" placeholder="Detaylar..."></textarea>

    <label>Referans Kişi</label>
    <input type="text" id="referans" placeholder="Seni öneren kişi (isteğe bağlı)" />

    <button onclick="teklifHazirla()">TEKLİFİ OLUŞTUR</button>

    <div id="output"></div>

    <button class="accordion">Teklifler</button>
    <div class="panel" id="tekliflerPanel">
      <div id="tekliflerListesi" class="card-container"></div>
    </div>

    <button class="accordion">Sözleşmeler</button>
    <div class="panel" id="sozlesmelerPanel">
      <div id="sozlesmelerListesi" class="card-container"></div>
    </div>

    <!-- Düzenleme Formu (gizli) -->
    <div id="editForm" style="display:none;">
      <h3>Teklifi Düzenle</h3>
      <label>Müşteri Adı</label>
      <input type="text" id="editAd" />

      <label>Çekim Türü</label>
      <input type="text" id="editCekim" placeholder="Örn: Düğün, Save the Date, Ürün" />

      <label>Paket Seçimi</label>
      <select id="editPaket" onchange="editPaketBilgisiYukle()">
        <option value="">-- Paket Seçin --</option>
        <option value="bronze">Bronze</option>
        <option value="silver">Silver</option>
        <option value="gold">Gold</option>
      </select>

      <label>Etkinlik Yeri</label>
      <input type="text" id="editYer" placeholder="Örn: İstanbul, Kemerburgaz Ormanı" />

      <label>Tarih</label>
      <input type="date" id="editTarih" />

      <label>Fiyat (TL)</label>
      <input type="number" id="editFiyat" />

      <label>Açıklama</label>
      <textarea id="editAciklama" rows="3" placeholder="Detaylar..."></textarea>

      <label>Referans Kişi</label>
      <input type="text" id="editReferans" placeholder="Seni öneren kişi (isteğe bağlı)" />

      <button onclick="kaydetDuzenleme()">Kaydet</button>
      <button class="btn-cancel" onclick="iptalDuzenleme()">İptal</button>
    </div>
  </div>

  <!-- PDF içeriği için gizli div -->
  <div id="pdfContent" class="pdf-content" style="display:none;">
    <!-- PDF içeriği buraya dinamik olarak eklenecek -->
  </div>

<script>
  const paketler = {
    bronze: {
      fiyat: 3000,
      aciklama: "2 saat çekim, 30 düzenlenmiş fotoğraf, 1 dakikalık reels"
    },
    silver: {
      fiyat: 5000,
      aciklama: "4 saat çekim, 60 düzenlenmiş fotoğraf, 2 dakikalık klip"
    },
    gold: {
      fiyat: 8000,
      aciklama: "Tüm gün çekim, 100+ fotoğraf, drone + 3 dakikalık klip"
    }
  };

  let teklifler = [];
  let sozlesmeler = [];
  let duzenlenenTeklifId = null;

  // Accordion aç/kapa
  document.querySelectorAll(".accordion").forEach(button => {
    button.addEventListener("click", () => {
      button.classList.toggle("active");
      const panel = button.nextElementSibling;
      if(panel.style.display === "block") {
        panel.style.display = "none";
      } else {
        panel.style.display = "block";
      }
    });
  });

  function paketBilgisiYukle() {
    const secilen = document.getElementById("paket").value;
    if (paketler[secilen]) {
      document.getElementById("fiyat").value = paketler[secilen].fiyat;
      document.getElementById("aciklama").value = paketler[secilen].aciklama;
    }
  }

  function editPaketBilgisiYukle() {
    const secilen = document.getElementById("editPaket").value;
    if (paketler[secilen]) {
      document.getElementById("editFiyat").value = paketler[secilen].fiyat;
      document.getElementById("editAciklama").value = paketler[secilen].aciklama;
    }
  }

  function teklifHazirla() {
    const ad = document.getElementById("ad").value.trim();
    if (!ad) {
      alert("Müşteri adı boş bırakılamaz!");
      return;
    }
    const cekim = document.getElementById("cekim").value
      .split(',')
      .map(c => c.trim())
      .filter(Boolean)
      .map(c => `- ${c}`)
      .join('<br>');
    const paket = document.getElementById("paket").value.toUpperCase();
    const yer = document.getElementById("yer").value;
    const tarih = document.getElementById("tarih").value;
    const fiyat = document.getElementById("fiyat").value;
    const aciklama = document.getElementById("aciklama").value.replace(/\n/g, '<br>');
    const referans = document.getElementById("referans").value;
    const bugun = new Date().toLocaleDateString('tr-TR');

    const teklif = {
      id: Date.now(),
      ad, cekim, paket, yer, tarih, fiyat, aciklama, referans, bugun,
    };
    teklifler.push(teklif);

    renderTeklifler();

    document.getElementById("output").innerHTML = "Teklif başarıyla oluşturuldu! Aşağıda listede görebilirsiniz.";

    // Formu temizle
    ["ad", "cekim", "paket", "yer", "tarih", "fiyat", "aciklama", "referans"].forEach(id => {
      if(id === "paket") document.getElementById(id).value = "";
      else document.getElementById(id).value = "";
    });
  }

  function renderTeklifler() {
    const container = document.getElementById("tekliflerListesi");
    container.innerHTML = "";
    teklifler.forEach(teklif => {
      const card = document.createElement("div");
      card.className = "card";

      card.innerHTML = `
        <h3>${teklif.ad}</h3>
        <p><strong>Çekim Türü:</strong><br>${teklif.cekim}</p>
        <p><strong>Paket:</strong> ${teklif.paket}</p>
        <p><strong>Etkinlik Yeri:</strong> ${teklif.yer}</p>
        <p><strong>Tarih:</strong> ${teklif.tarih}</p>
        <p><strong>Fiyat:</strong> ${teklif.fiyat} TL</p>
        <button onclick="teklifiGoster(${teklif.id})">Teklifi Göster</button>
        <button onclick="pdfOlusturVePaylas(${teklif.id})">PDF Kaydet ve Paylaş</button>
        <button onclick="teklifiDuzenle(${teklif.id})">Düzenle</button>
        <button onclick="teklifiKabulEt(${teklif.id})">Sözleşmeye Dönüştür</button>
      `;

      container.appendChild(card);
    });
  }

  function teklifiGoster(id) {
    const teklif = teklifler.find(t => t.id === id);
    if (!teklif) return alert("Teklif bulunamadı.");

    const html = `
      <div style="border:2px solid #007bff; padding:20px; border-radius:10px; max-width:700px; margin:auto; background:#fff;">
        <div style="text-align:center; margin-bottom:20px;">
          <img src='https://i.hizliresim.com/eqyhuxx.png' style="max-height:80px;">
          <h2 style="color:#007bff; margin:10px 0;">📸 FOTOĞRAFÇILIK HİZMET TEKLİFİ</h2>
        </div>
        <div style="font-size:16px; color:#333; line-height:1.6;">
          <p><strong>👤 Müşteri:</strong> ${teklif.ad}</p>
          <p><strong>📷 Çekim Türü:</strong><br>${teklif.cekim}</p>
          <p><strong>📦 Paket:</strong> ${teklif.paket}</p>
          <p><strong>📍 Etkinlik Yeri:</strong> ${teklif.yer}</p>
          <p><strong>📅 Tarih:</strong> ${teklif.tarih}</p>
          <p><strong>💰 Fiyat:</strong> ${teklif.fiyat} TL</p>
          <p><strong>📝 Açıklama:</strong><br>${teklif.aciklama}</p>
          ${teklif.referans.trim() !== "" ? `<p><strong>👥 Referans:</strong> ${teklif.referans}</p>` : ""}
        </div>
        <div style="margin-top:30px; text-align:center; font-size:14px; color:#666;">
          Bu teklif <strong>${teklif.bugun}</strong> tarihinde hazırlanmıştır.<br>
          Fotoğrafçı: <strong>PASOVART</strong> | Tüm hakları saklıdır.
        </div>
      </div>
    `;
    document.getElementById("output").innerHTML = html;
  }

  function pdfOlusturVePaylas(id) {
    const teklif = teklifler.find(t => t.id === id);
    if (!teklif) return alert("Teklif bulunamadı.");

    // PDF içeriğini hazırla
    const pdfContent = document.getElementById("pdfContent");
    pdfContent.innerHTML = `
      <div class="pdf-header">
        <img src="https://i.hizliresim.com/eqyhuxx.png" alt="Logo">
        <h1 class="pdf-title">📸 FOTOĞRAFÇILIK HİZMET TEKLİFİ</h1>
      </div>
      <div class="pdf-body">
        <p><strong>👤 Müşteri:</strong> ${teklif.ad}</p>
        <p><strong>📷 Çekim Türü:</strong><br>${teklif.cekim}</p>
        <p><strong>📦 Paket:</strong> ${teklif.paket}</p>
        <p><strong>📍 Etkinlik Yeri:</strong> ${teklif.yer}</p>
        <p><strong>📅 Tarih:</strong> ${teklif.tarih}</p>
        <p><strong>💰 Fiyat:</strong> ${teklif.fiyat} TL</p>
        <p><strong>📝 Açıklama:</strong><br>${teklif.aciklama}</p>
        ${teklif.referans.trim() !== "" ? `<p><strong>👥 Referans:</strong> ${teklif.referans}</p>` : ""}
      </div>
      <div class="pdf-footer">
        <p>Bu teklif <strong>${teklif.bugun}</strong> tarihinde hazırlanmıştır.</p>
        <p>Fotoğrafçı: <strong>PASOVART</strong> | Tüm hakları saklıdır.</p>
      </div>
    `;

    // PDF'i göster ve yazdır menüsünü aç
    pdfContent.style.display = "block";
    
    // Kısa bir süre bekle ki içerik yüklensin
    setTimeout(() => {
      window.print();
      
      // Yazdırdıktan sonra WhatsApp paylaşımını sor
      setTimeout(() => {
        pdfContent.style.display = "none";
        
        if (confirm("PDF kaydedildi! Şimdi WhatsApp'ta paylaşmak ister misiniz?")) {
          whatsappPaylas(id);
        }
      }, 1000);
    }, 500);
  }

  function whatsappPaylas(id) {
    const teklif = teklifler.find(t => t.id === id);
    if (!teklif) return alert("Teklif bulunamadı.");
    
    // WhatsApp mesaj metni hazırlama
    let mesaj = `📸 Fotoğrafçılık Hizmet Teklifi\n\n`;
    mesaj += `Müşteri: ${teklif.ad}\n`;
    mesaj += `Çekim Türü: ${teklif.cekim.replace(/<br>/g, ', ').replace(/- /g,'')}\n`;
    mesaj += `Paket: ${teklif.paket}\n`;
    mesaj += `Etkinlik Yeri: ${teklif.yer}\n`;
    mesaj += `Tarih: ${teklif.tarih}\n`;
    mesaj += `Fiyat: ${teklif.fiyat} TL\n`;
    mesaj += `Açıklama: ${teklif.aciklama.replace(/<br>/g, '\n')}\n`;
    if (teklif.referans.trim() !== "") {
      mesaj += `Referans: ${teklif.referans}\n`;
    }
    mesaj += `\n📄 Detaylı teklif PDF'i ekte gönderilmiştir.\n\nFotoğrafçı: Ferdi Kabalı`;

    const url = `https://wa.me/?text=${encodeURIComponent(mesaj)}`;
    window.open(url, '_blank');
  }

  function teklifiDuzenle(id) {
    const teklif = teklifler.find(t => t.id === id);
    if(!teklif) return alert("Teklif bulunamadı.");

    duzenlenenTeklifId = id;

    // Açık panel varsa kapat (opsiyonel)
    document.getElementById("output").innerHTML = "";

    // Düzenleme formunu göster ve alanları doldur
    document.getElementById("editAd").value = teklif.ad;
    document.getElementById("editCekim").value = teklif.cekim.replace(/- /g, '').replace(/<br>/g, ', ');
    document.getElementById("editPaket").value = teklif.paket.toLowerCase();
    document.getElementById("editYer").value = teklif.yer;
    document.getElementById("editTarih").value = teklif.tarih;
    document.getElementById("editFiyat").value = teklif.fiyat;
    document.getElementById("editAciklama").value = teklif.aciklama.replace(/<br>/g, '\n');
    document.getElementById("editReferans").value = teklif.referans;

    document.getElementById("editForm").style.display = "block";
    window.scrollTo({top: 0, behavior: 'smooth'});
  }

  function kaydetDuzenleme() {
    if(duzenlenenTeklifId === null) return;

    const ad = document.getElementById("editAd").value.trim();
    if (!ad) {
      alert("Müşteri adı boş bırakılamaz!");
      return;
    }

    const cekim = document.getElementById("editCekim").value
      .split(',')
      .map(c => c.trim())
      .filter(Boolean)
      .map(c => `- ${c}`)
      .join('<br>');
    const paket = document.getElementById("editPaket").value.toUpperCase();
    const yer = document.getElementById("editYer").value;
    const tarih = document.getElementById("editTarih").value;
    const fiyat = document.getElementById("editFiyat").value;
    const aciklama = document.getElementById("editAciklama").value.replace(/\n/g, '<br>');
    const referans = document.getElementById("editReferans").value;

    const index = teklifler.findIndex(t => t.id === duzenlenenTeklifId);
    if (index !== -1) {
      teklifler[index] = {
        ...teklifler[index],
        ad, cekim, paket, yer, tarih, fiyat, aciklama, referans
      };
    }

    duzenlenenTeklifId = null;
    document.getElementById("editForm").style.display = "none";
    document.getElementById("output").innerHTML = "Teklif başarıyla güncellendi.";

    renderTeklifler();
  }

  function iptalDuzenleme() {
    duzenlenenTeklifId = null;
    document.getElementById("editForm").style.display = "none";
  }

  function teklifiKabulEt(id) {
    const teklif = teklifler.find(t => t.id === id);
    if (!teklif) return alert("Teklif bulunamadı.");

    sozlesmeler.push(teklif);
    teklifler = teklifler.filter(t => t.id !== id);
    document.getElementById("output").innerHTML = "Teklif sözleşmeye dönüştürüldü.";

    renderTeklifler();
    renderSozlesmeler();
  }

  function renderSozlesmeler() {
    const container = document.getElementById("sozlesmelerListesi");
    container.innerHTML = "";
    sozlesmeler.forEach(soz => {
      const card = document.createElement("div");
      card.className = "card";

      card.innerHTML = `
        <h3>${soz.ad}</h3>
        <p><strong>Çekim Türü:</strong><br>${soz.cekim}</p>
        <p><strong>Paket:</strong> ${soz.paket}</p>
        <p><strong>Tarih:</strong> ${soz.tarih}</p>
        <p><strong>Fiyat:</strong> ${soz.fiyat} TL</p>
      `;

      container.appendChild(card);
    });
  }
</script>

</body>
</html>
